<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CUESTIONARIO DE ESQUEMAS DE J. YOUNG</title>
  <style>
    :root {
      --bg: #0b0c0e;
      --card: #121418;
      --muted: #9aa3af;
      --text: #e5e7eb;
      --accent: #a78bfa;
      --accent-2: #34d399;
      --danger: #ef4444;
      --border: #1f2937;
    }
    html, body { background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    * { box-sizing: border-box; }
    .container { max-width: 980px; margin: 24px auto 96px; padding: 0 16px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid var(--border); border-radius: 18px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    h1 { font-size: clamp(24px, 3.4vw, 36px); margin: 0 0 8px; letter-spacing: 0.3px; }
    .subtitle { color: var(--muted); line-height: 1.5; margin-bottom: 18px; font-size: 14px; }
    .grid { display: grid; gap: 16px; }
    .form-grid { grid-template-columns: repeat(6, minmax(0,1fr)); }
    .input { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; color: var(--text); width: 100%; }
    label { font-size: 13px; color: var(--muted); display: block; margin-bottom: 6px; }

    .pill { display: inline-flex; align-items: center; gap: 8px; border: 1px solid var(--border); border-radius: 999px; padding: 6px 12px; background: rgba(255,255,255,0.03); color: var(--muted); font-size: 12px; }
    .kbd { border: 1px solid var(--border); border-bottom-width: 3px; border-radius: 6px; padding: 2px 6px; background: #0f1115; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color: var(--text); }

    .scale { display: grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap: 6px; }
    .scale .opt { display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); background: #0e1014; border-radius: 12px; padding: 10px 8px; cursor: pointer; transition: transform .05s ease, border-color .2s; user-select: none; }
    .scale input { display: none; }
    .scale .opt:hover { border-color: #2a3546; }
    .scale input:checked + .opt { outline: 2px solid rgba(167,139,250,.25); border-color: var(--accent); background: radial-gradient(120px 80px at 50% -10%, rgba(167,139,250,.25), transparent 60%); }

    .q { border-top: 1px dashed var(--border); padding-top: 14px; margin-top: 14px; }
    .q h3 { margin: 0 0 10px; font-size: 15px; line-height: 1.35; }

    .sticky-submit { position: fixed; inset-inline: 0; bottom: 0; background: linear-gradient(180deg, rgba(11,12,14,0), var(--bg) 30%), var(--bg); border-top: 1px solid var(--border); padding: 14px 16px; }
    .sticky-inner { max-width: 980px; margin: 0 auto; display: flex; gap: 12px; align-items: center; justify-content: space-between; }
    .btn { background: var(--accent); border: none; color: #0b0c0e; font-weight: 600; padding: 12px 16px; border-radius: 12px; cursor: pointer; transition: transform .05s ease; }
    .btn:active { transform: translateY(1px); }
    .btn.secondary { background: #111318; color: var(--text); border: 1px solid var(--border); }

    .muted { color: var(--muted); }
    .progress { height: 10px; background: #0f1115; border-radius: 999px; border: 1px solid var(--border); overflow: hidden; }
    .progress > div { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); width: 0%; }

    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { border-bottom: 1px solid var(--border); padding: 8px 6px; text-align: right; }
    th:first-child, td:first-child { text-align: left; }
    .ok { color: var(--accent-2); }
    .warn { color: var(--danger); }

    .tag { display:inline-block; padding:2px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; color:var(--muted); }

    @media (max-width: 880px) {
      .form-grid { grid-template-columns: 1fr; }
      .scale { grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
      .progress-fixed{position:fixed;top:0;left:0;right:0;height:6px;background:#0f1115;border-bottom:1px solid var(--border);z-index:1000}
    .progress-fixed>div{height:100%;background:linear-gradient(90deg, var(--accent), var(--accent-2));width:0%}

    /* ====== FIXES MOVIL ====== */

/* Evita que cualquier desborde genere scroll horizontal global */
html, body { overflow-x: hidden; }

/* Rejilla de preguntas: columnas fluidas que nunca crecen más que el 100% */
#questions {
  display: grid;
  /* Cada tarjeta ocupa hasta 420px, pero nunca más del 100% del viewport */
  grid-template-columns: repeat(auto-fit, minmax(min(420px, 100%), 1fr));
  gap: 8px; /* por si algún inline-style cambia */
}

/* Fuerza cortes en palabras/strings sin espacios para que no "rompan" el layout */
.q h3, .subtitle, .card h1, .card h2, .card p {
  overflow-wrap: anywhere; /* el más permisivo para móviles */
  word-break: break-word;  /* fallback */
}

/* Por si algún hijo de la grilla insiste en crecer */
#questions > * { min-width: 0; }

/* Opciones de la escala: asegúrate de que sus celdas puedan encogerse sin forzar ancho */
.scale > label { min-width: 0; }

/* Ya tenías 3 columnas bajo 880px; mantenlo, funciona bien para dedos en móvil */
@media (max-width: 880px) {
  .scale { grid-template-columns: repeat(3, minmax(0,1fr)); }
}

/* Barra de progreso fija arriba: la haces más "a prueba de todo" */
.progress-fixed{
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 6px;
  background: #0f1115;
  border-bottom: 1px solid var(--border);
  z-index: 9999; /* más alto por si hay headers pegajosos */
}
.progress-fixed>div{
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  width: 0%;
  transition: width .15s ease; /* se ve más suave */
}

/* La barra inferior pegajosa puede envolver su contenido en pantallas angostas */
.sticky-inner { flex-wrap: wrap; }

/* (Opcional) Si al mostrar resultados la tabla es muy ancha, evita que “empuje” el viewport */
#resultsTableWrap { overflow-x: auto; }
#resultsTableWrap table { min-width: 520px; }

  </style>
</head>
<body>
  <div class="progress-fixed" aria-hidden="true"><div id="progressFixed"></div></div>
  <div class="container">
    <div class="card" style="margin-bottom:16px">
      <h1>CUESTIONARIO DE ESQUEMAS DE J. YOUNG</h1>
      <p class="subtitle">
        Desarrollado por Jeffrey E. Young y Gary Brown, Med. Copyright, 1990. Tomado de Jeffrey E. Young (1999). "Cognitive therapy for personality disorders: A schema‑focused approach". Third Edition. Sarasota, Florida. Professional Resource Press.
      </p>
      <div class="grid form-grid">
        <div>
          <label>Nombre</label>
          <input class="input" name="nombre" autocomplete="name" />
        </div>
        <div>
          <label>Escolaridad</label>
          <input class="input" name="escolaridad" />
        </div>
        <div>
          <label>Ocupación</label>
          <input class="input" name="ocupacion" />
        </div>
        <div>
          <label>Edad</label>
          <input class="input" name="edad" type="number" min="0" />
        </div>
        <div>
          <label>Estado civil</label>
          <input class="input" name="edoCivil" />
        </div>
        <div>
          <label class="muted">Progreso</label>
          <div class="progress" title="Progreso de respuestas">
            <div id="progressBar"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-bottom:16px">
      <div class="pill" style="margin-bottom:10px">Instrucciones</div>
      <p class="subtitle" style="margin:0">
        En la lista de abajo hay una serie de afirmaciones que una persona podría emplear para describirse a sí misma. Por favor lea cada afirmación y decida qué tan bien lo describe. Cuando no esté seguro, base su respuesta en lo que emocionalmente siente, no en lo que piense que es cierto. Si lo desea, reorganice la frase de tal manera que se adecue más a usted. Luego escoja el valor más alto de <b>1 a 6</b> que lo describa, y marque el número con una X en el recuadro correspondiente en cada afirmación.
      </p>
      <div style="margin-top:12px; display:grid; gap:8px">
        <div class="tag">1 Completamente falso de mí</div>
        <div class="tag">2 La mayor parte falso de mí</div>
        <div class="tag">3 Ligeramente más verdadero que falso</div>
        <div class="tag">4 Moderadamente verdadero de mí</div>
        <div class="tag">5 La mayor parte verdadero de mí</div>
        <div class="tag">6 Me describe perfectamente</div>
      </div>
    </div>

    <div id="questions" class="grid" style="gap:8px"></div>

    <div class="card" id="resultsCard" style="display:none; margin-top:16px">
      <h2 style="margin:0 0 8px">Resultados por grupo</h2>
      <p class="subtitle" style="margin:0 0 12px">Las fórmulas replican tu archivo: <b>Suma</b> (col. B) por rangos de respuestas, <b>Máximo</b> (col. C) = número de reactivos×6 y <b>%</b> (col. D) = (B/C)*100.</p>
      <div id="resultsTableWrap"></div>
    </div>
  </div>

  <div class="sticky-submit">
    <div class="sticky-inner">
      <div class="muted">Respondidas: <span id="answeredCount">0</span> / <span id="totalCount">205</span></div>
      <div style="display:flex; gap:8px">
        <button class="btn secondary" id="exportCsvBtn" type="button">Descargar CSV</button>
        <button class="btn" id="submitBtn" type="button">Calcular & Enviar resultados</button>
      </div>
    </div>
  </div>

  <!-- EmailJS (rellena tus claves en EMAILJS_CONFIG más abajo) -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    // =====================
    // Configuración
    // =====================
    const EMAILJS_CONFIG = {
      serviceId: "REEMPLAZA_SERVICE_ID",
      templateId: "REEMPLAZA_TEMPLATE_ID",
      publicKey: "REEMPLAZA_PUBLIC_KEY",
      toEmail: "tu_correo@ejemplo.com"
    };    

    // Postmark (servidor propio). NO pongas tu token en el cliente.
    // Debes crear y desplegar un endpoint (ej. Vercel/Netlify/Azure).
    const POSTMARK_CONFIG = {
      endpointUrl: "", // ej. "/api/postmark-send" o "https://tuapp.vercel.app/api/postmark-send"
      fromEmail: "",  // debe coincidir con tu Sender Signature o dominio verificado en Postmark
      toEmail: ""     // a dónde recibes los resultados
    };

    // WhatsApp: si pones tu número en formato internacional (sin +, sin espacios),
    // al enviar se abrirá WhatsApp con el mensaje prellenado y el usuario solo toca "Enviar".
    // Ejemplo México: 5215512345678
    const WHATSAPP_CONFIG = {
      number: "5215587395422", // <-- escribe aquí tu número. Si está vacío, se omite.
      addAnswers: false // si true, incluye además el listado de 205 respuestas al final (puede ser largo)
    };

    // Rangos de grupos (basados en tu imagen; ajustamos el último para evitar doble conteo del #190)
    const GROUPS = [
      { name: "Grupo 1",  start: 1,   end: 9 },
      { name: "Grupo 2",  start: 10,  end: 27 },
      { name: "Grupo 3",  start: 28,  end: 44 },
      { name: "Grupo 4",  start: 45,  end: 54 },
      { name: "Grupo 5",  start: 55,  end: 69 },
      { name: "Grupo 6",  start: 70,  end: 78 },
      { name: "Grupo 7",  start: 79,  end: 87 },
      { name: "Grupo 8",  start: 88,  end: 102 },
      { name: "Grupo 9",  start: 103, end: 116 },
      { name: "Grupo 10", start: 117, end: 127 },
      { name: "Grupo 11", start: 128, end: 137 },
      { name: "Grupo 12", start: 138, end: 154 },
      { name: "Grupo 13", start: 155, end: 163 },
      { name: "Grupo 14", start: 164, end: 179 },
      { name: "Grupo 15", start: 180, end: 190 },
      { name: "Grupo 16", start: 191, end: 205 } // <- C16=90 (=15*6)
    ];

    // Afirmaciones iniciales (27). Puedes añadir las que faltan **en este mismo arreglo**;
    // si hay menos de 205, se repetirá la última automáticamente hasta llegar a 205.

  const QUESTIONS = [
  "Las personas no han estado ahí para satisfacer mis necesidades emocionales ",
"No he recibido amor y atención ",
"La mayor parte del tiempo, no he tenido a nadie que me brinde consejo y apoyo emocional",
"La mayor parte del tiempo,no he tenido a nadie que me cuide, que comparta conmigo o que se preocupe profundamente por todo lo que me pasa",
"Por mucho tiempo de mi vida,no he tenido a nadie que quisiera estar estrechamente ligado a mi, y compartir mucho tiempo",
"En general, las personas no han estado ahí para darme calidez, apoyo y afecto",
"Por mucho tiempo de mi vida no he sentido que sea especial para nadie",
"La mayor parte del tiempo no he tenido a nadie que realmente me escuche, me comprendao este sintonizado con mis verdaderas necesidades y sentimientos",
"Rara vez he tenido una persona fuerte que me brinde consejos sabios o dirección cuando no estoy seguro de qué hacer",
"Me preocupa que las personas aquienes quiero mucho mueran pronto, aún cuando existen muy pocas razones médicas que sustentan mi preocupación",
"Me descubro a mí mismo(a), aferrándome a las personas de quienes estoy cerca porque temo que me abandonen",
"Me preocupa que las personas a quienesme siento cercano me dejen o me abandonen",
"Siento que me falta una base estable de apoyo emocional",
"No siento que las relaciones interpersonales importantes vayan a durar. Tengo la expectativa que ellas se acabarán",
"Me siento adicto(a) a parejas que no pueden estar ahí para mí en forma comprometida",
"Al final, estaré solo(a)",
"Cuando siento que alguien que me importa, esta tratando de alejarse de mí, me desespero",
"Algunas veces estoy tan preocupado(a) de que las personas vayan a abandonarme, que termino alejándolas",
"Me aflijo cuando alguien me deja solo(a), aún por un corto periodo de tiempo",
"No puedo contar con que las personas que me apoyan estén presentes en forma consistente",
"No me permito acercarme de verdad a otras personas, ya que no puedo estar seguro(a) de que estarán ahí para siempre",
"Pareciera que las personas importantes en mi vida siempre están yendo y viniendo",
"Me preocupa muchisimo que las personas a quienes quiero encuentren a alguien más a quien prefieran, y me dejen",
"Las personas que han estado cerca de mi han sido muy impredecibles, unas veces estan disponibles y cariñosas conmigo y al minuto están enojadas, molestas, peleándose, etc.",
"Necesito tanto a las otras personas que me preocupo acerca de la posibilidad de perderlas",
"Me siento tan indefenso(a) si no tengo personas que me protejan, que me procupa perderlas",
"No puedo ser yo mismo(a) o expresar lo que en realidad yo siento, porque las  personas me abandonarán",
"Siento que las personas se aprovechan de mi",
"Con frecuencia siento que tengo que protegerme de otras personas",
"Siento que no puedo bajar la guardia en presencia de otras personas, porque de otra manera van a herirme emocionalmente",
"Si alguien se comporta muy amable conmigo, asumo que esa persona debe estar buscando algo",
"Es sólo cuestión de tiempo antes de que alguien me traicione",
"La mayoría de las personas sólo piensan en si mismas",
"Tengo una gran dificultad para confiar en la gente",
"Sospecho mucho de las intenciones de las otras personas",
"Las otras personas muy rara vez son honestas; generalmente no son lo que parecen",
"Usualmente estoy en búsqueda de las verdaderas intenciones de los demás",
"Si pienso que alguien va a herirme, trato de herirlo(a)",
"Normalmente las personas me tienen que demostrar mucho, antes de que pueda confiar en ellas",
"Le pongo 'pruebas' a los demás para ver si me están diciendo la verdad y si son bien intencionadas",
"Me identifico con la creencia: 'controla o serás controlado'",
"Me enojo cuando pienso en las distintas formas en que he sido maltratado(a) por otras personas a lo largo de mi vida",
"A lo largo de la vida, aquellas personas cercanas a mi se han aprovechado o me han usado para sus propósitos",
"He sido abusado(a) sexual, emocional o físicamente por personas importantes en mi vida",
"No encajo en ninguna parte",
"Soy fundamentalmente diferente a las otras personas",
"No pertenezco; soy un solitario(a)",
"Me siento alejado de otras personas",
"Me siento aislado y solo(a) ",
"Siempre me siento ajeno(a) a los grupos",
"Nadie en realidad me comprende",
"Mi familia siempre fue diferente de las otras familias que nos rodeaban",
"Algunas veces me siento como si fuera un(a) extraterrestre",
"Si desapareciera mañana, nadie lo notaría",
"Ninguna persona a quien yo deseara podría amarme si conociera mis defectos",
"Nadie a quien yo quisiera desearía permenecer cerca de mi si conociera mi verdadero yo",
"Yo soy inherentemente imperfecto y defectuoso",
"No importa que tanto lo intente, siento que no seré capaz de conseguir una persona significativa que me respete o que sienta que soy valioso(a)",
"No merezco el respeto, la atención y el amor de los demás",
"Siento que no soy digno(a) de ser amado(a)",
"Soy demasiado inaceptable en muchos aspectos básicos como para revelarme ante otras personas",
"Si los demás se dieran cuenta de mis defectos básicos no podría darles la cara",
"Cuando le gusto a las personas, siento que las estoy engañando",
"Con frecuencia me descubro a mi mismo atraido por personas muy críticas o que me rechazan",
"Tengo secretos muy personales, y no quiero que las personas cercanas a mi los descubran",
"Es culpa mia que mis padres no pudieran amarme lo suficiente",
"No permito que las personas conozcan mi verdadero yo",
"Uno de mis mayores miedos es que mis defectos queden al descubierto",
"No puedo entender cómo alguien podria amarme",
"No soy sexualmente atractivo(a)",
"Soy demasiado gordo(a)",
"Soy feo(a)",
"No soy capaz de mantener una conversacion normal",
"Soy soso y aburrido(a) en situaciones sociales",
"Personas que considero valiosas no se relacionarian comigo, por mi posicion social ( por ejemplo, ingresos, nivel educativo, carrera, entre otros)",
"Nunca sé qué decir en situaciones sociales ",
"Las personas no quieren incluirme en sus grupos",
"Soy demasiado consciente de mi mismo(a) cuando estoy con otras personas",
"Casi nada de lo que hago en mi trabajo (o estudio) es tan bueno como lo pueden hacer otras personas",
"Soy incompetente cuando de logros se trata",
"La mayoria de las personas son mas capaces que yo en las areas de trabajo y logro",
"Soy un (a) fracasado(a)",
"No soy tan talentoso(a) como la mayoria de las personas en su trabajo",
"No soy tan inteligente como la mayoria de las personas en lo que se refiere al trabajo (o estudio)",
"Estoy avergonzado por mis inadecuaciones y fracasos en la esfera del trabajo",
"Con frecuencia me siento avergonzado cuando estoy con otras personas, ya que yo no estoy a su nivel en términos de logros",
"Con frecuencia comparo mis logros con los demas y siento que ellos son mucho más exitosos",
"No me siento capaz de valorarme por mi mismo en la vida diaria",
"Necesito que otras personas me ayuden a sostenerme",
"No siento que pueda enfrentar bien la vida por mi mismo",
"Creo que otras personas pueden ocuparse mejor de mi, que yo mismo",
"Tengo problemas emprendiendo nuevas tareas, aparte de mi trabajo, a menos que tenga a alguien que me guíe",
"Me veo a mi mismo como una persona dependiente cuando del funcionamiento de la vida diaria se trata",
"Hecho a perder todo lo que intento, aun cosas por fuera del trabajo o la escuela",
"Soy incapaz en la mayoria de los aspectos de mi vida",
"Si confio en mi propio juicio en situaciones cotidianas, tomaré malas decisiones",
"Me falta sentido común",
"En las situaciones cotidianas, no se puede confiar en mi juicio",
"No me siento seguro de mi habilidad para resolver problemas cotidianos cuando estos se presentan",
"Siento que necesito a alguien en quien pueda confiar para darme consejo sobre los problemas prácticos",
"Me siento más como como un niño que como un adulto, cuando se trata de las responsabilidades cotidianas",
"Encuentro agobiantes las responsabilidades de la vida cotidiana",
"No puedo escapar el sentimiento de que algo malo está a punto de pasar",
"Siento que un desastre (natural, delictivo, financero o médico) podria golpearme en cualquier momento",
"Me preocupa volverme un indigente o un vago",
"Me preocupa ser atacado",
"Siento que debo tener mucho cuidado con el dinero porque de otra manera podría terminar sin nada, en la ruina",
"Tomo grandes precauciones para evitar lastimarme o herirme",
"Me preocupa perder todo mi dinero y volverme indigente",
"Me preocupa estar desarrollando una enfermedad",
"Soy una persona temerosa",
"Me preocupa mucho la cantidad de cosas malas que ocurren en el mundo: contaminación, crímenes, entre otros",
"Con frecuencia siento que podría enloquecerme",
"Con frecuencia siento que voy a tener un ataque de ansiedad",
"Con frecuencia me preocupa tener un ataque al corazón, aún cuando hay muy poca evidencia médica para sentirlo",
"Siento que el mundo es un lugar peligroso",
"No parezco haber sido capaz de separarme de mis padres del mismo modo que otras personas de mi edad parecen haberlo hecho",
"Mis padres y yo tendemos a involucrarnos demasiado en la vida y problemas de cada uno",
"Es muy difícil tanto para mis padres como para mi, callar detalles íntimos",
"Mis padres y yo tenemos que hablarnos casi a diario o de otra manera alguno se sentirá culpable, lastimado o solo.",
"Con frecuencia siento que no tengo una identidad separada de mis padres o mis compañeros(as)",
"Con frecuencia siento como si mis padres estuvieran viviendo a través mío o que no tengo VALOR una vida propia.",
"Es muy difícil para mí tomar distancia de las personas con quienes intimo. Se me dificultad conservar un sentido de mi mismo separado de ellas.",
"Estoy tan involucrado con mis padres o compañeros(as) que en realidad no sé quien soy o qué quiero.",
"Tengo dificultades en separar mi punto de vista u opinión de las de mis padres o compañeros.",
"Con frecuencia siento que no tengo intimidad cuando se trata de mis padres o compañeros(a).",
"Siento que mis padres se sienten o sentirían muy lastimados y ofendidos si yo viviera solo por mis propios medios, lejos de ellos.",
"Permito que otras personas hagan lo que quieran, porque temo las consecuencias.",
"Pienso que si hago lo que quiero, sólo estaría buscando problemas.",
"Siento que no tengo otra opción que rendirme a los deseos de otras personas, o de otra manera ellos se vengarán o me rechazarán de alguna forma.",
"En relaciones interpersonales, yo dejo que la otra persona tome la delantera.",
"Siempre he permitido que otros tomen decisiones por mí, de tal forma que en realidad no sé lo que quiero para mi mismo.",
"Siento que las principales decisiones de mi vida no fueron mías realmente.",
"Me preocupa mucho complacer a otros, para que no me rechacen.",
"Me cuesta mucho trabajo exigir que mis derechos sean respetados y que mis sentimientos sean tenidos en cuenta.",
"Recrimino a las personas de maneras sutiles, en lugar de mostrar mi enojo.",
"Voy mucho más lejos que la mayoría de las personas para evitar confrontaciones.",
"Pongo las necesidades de los demás antes que las mías o de otra manera me siento culpable.",
"Me siento culpable cuando traiciono o decepciono a otras personas.",
"Le doy más a los demás de lo que recibo a cambio.",
"Usualmente soy el (la) que termino cuidando a las personas a quienes tengo cerca.",
"Podría soportarlo todo si me amara alguien.",
"Soy una buena persona porque pienso en los demás, más que en mi mismo.",
"En el trabajo, soy el (la ) que usualmente se ofrece voluntariamente a hacer tareas extras o dar tiempo extra.",
"No importa que tan ocupado(a) esté, siempre puedo encontrar tiempo para otros.",
"Puedo conformarme con muy poco, ya que mis necesidades son mínimas.",
"Solo soy feliz cuando los demás a mi alrededor están felices.",
"Estoy tan ocupado(a) haciendo cosas por las personas que me son importantes, que tengo muy poco tiempo para mí",
"Siempre he sido quien escucha los problemas de todo el mundo. ",
"Estoy más cómodo(a) dando un regalo que recibiéndolo.",
"Los demás me ven demasiado entregado (a) a otros y no lo suficiente a mi mismo.",
"No importa cuanto de, nunca es suficiente.",
"Si hago lo que yo quiero, me siento muy incomodo(a).",
"Me es difícil pedir a otros ayuda cuando tego necesidades.",
"Me preocupa perder el control de mis acciones.",
"Me preocupa que yo pueda causarle daño fisico o emocional seriamente a alguien, si mi enojo llega a estar fuera de control.",
"Siento que tengo que controlar mis impulsos o emociones, o es probable que algo malo ocurra.",
"Hay mucha ira y resentimiento creciendo dentro de mi, que no soy capaz de expresar.",
"Soy de masiado autoconsciente como para expresarle a otros mis sentimientos positivos (por ejemplo: afecto, cuidados).",
"Me da vergüenza expresar mis sentimientos a otros.",
"Me es difícil ser cálido y espontáneo.",
"Me controlo tanto, que los demás creen que no tengo emociones.",
"La gente me ve como constreñido emocionalmente (cerrado, hermético).",
"No puedo aceptar ser el (la ) segundo(a).",
"Me esfuerzo por mantener casi todo en perfecto orden.",
"Tengo que parecer lo mejor la mayoría del tiempo.",
"Trato de hacer lo mejor. No puedo conformarme con lo 'suficientemente bueno'.",
"Tengo tanto para hacer, que casi no hay tiempo para relajarse deveras.",
"Casi nada de lo que hago es lo suficientemente bueno, siempre puedo hacerlo mejor.",
"Tengo que cumplir todas mis responsabilidades.",
"Siento que existe constante presión para que alcance logros.",
"Mis relaciones interpersonales sufren porque yo me exijo mucho.",
"Mi salud está afectada porque me presiono demasiado para hacer las cosas bien.",
"Con frecuencia sacrifico placer y felicidad por alcanzar mis propios estándares.",
"Cuando cometo errores, me merezco fuertes críticas.",
"No puedo permitirme fácilmente desengancharme o tener excusas para mis errores.",
"Soy una persona muy competitiva.",
"Pongo una gran cantidad de énfasis en dinero y estatus.",
"En términos de mi desempeño, tengo que ser siempre el número uno.",
"Tengo mucha dificultad de aceptar un 'no' como respuesta cuando quiero algo de otras personas.",
"Con frecuencia me enojo o me irrito si no puedo conseguir lo que quiero.",
"Soy especial y no tendría por qué aceptar muchas de las restricciones que tienen otras personas.",
"Odio sentirme restringido o que se me impida hacer lo que quiero.",
"Siento que no tengo porqué seguir las reglas normales y otras convenciones que las demás personas tienen.",
"Tengo la sensación de que lo que ofrezco es de mayor valor que las contribuciones de los demás.",
"Usualmente pongo mis propias necesidades por encima de las de otras personas.",
"Con frecuencia siento que estoy tan involucrado en mis propias prioridades, que no tengo tiempo para dar a los amigos o a la familia.",
"Con frecuencia la gente me dice que controlo la manera como se hacen las cosas.",
"Me irrito mucho cuando las personas no hacen lo que yo les pido.",
"No puedo tolerar que otras personas me digan lo que tengo que hacer.",
"Tengo gran dificultad para convencerme de dejar de beber, fumar, comer en exceso u otros problemas del comportamiento.",
"Parece que no puedo disciplinarme a mí mismo para complementar tareas rutinarias o aburridas.",
"Con frecuencia me dejo llevar por mis impulsos y expreso emociones que me generan problemas o hieren a otras personas.",
"Si no consigo una meta, me frustro fácilmente y la abandono.",
"Es para mí muy difícil sacrificar una satisfacción inmediata para alcanzar una meta a largo plazo.",
"Con frecuencia me pasa que una vez que empiezo a sentirme enojado, ya no puedo controlarlo.",
"Tiendo a hacer cosas en exceso aún cuando sé que son malas para mí.",
"Me aburro muy fácilmente",
"Cuando las tareas se vuelven difíciles, normalmente no puedo perseverar para completarlas.",
"No me puedo concentrar en nada por demasiado tiempo.",
"No me puedo forzar a hacer las cosas que no disfruto, aún cuando yo sé que son por mi bien.",
"Pierdo la paciencia a la menor ofensa.",
"Rara vez he sido capaz de cumplir lo que me he propuesto.",
"Casi nunca me cuido de mostrarle a las personas como me siento en realidad, sin importarme lo que me pueda costar.",
"Con frecuencia hago cosas impulsivamente de las cuales más tarde me arrepiento."
];        
    // Completar hasta 205 repitiendo la última
    while (QUESTIONS.length < 205) {
      QUESTIONS.push(QUESTIONS[QUESTIONS.length - 1] + ` (repetida)`);
    }

    // ===== Render =====
    const questionsWrap = document.getElementById('questions');
    const progressBar = document.getElementById('progressBar');
    const progressFixed = document.getElementById('progressFixed');
    const answeredCountEl = document.getElementById('answeredCount');
    const totalCountEl = document.getElementById('totalCount');
    totalCountEl.textContent = QUESTIONS.length;

    function qId(i) { return `q_${i}`; }

    function renderQuestions() {
      const frag = document.createDocumentFragment();
      QUESTIONS.forEach((text, idx) => {
        const n = idx + 1;
        const q = document.createElement('div');
        q.className = 'card q';
        q.innerHTML = `
          <h3><span class="muted">${n}.</span> ${text}</h3>
          <div class="scale" role="radiogroup" aria-label="Escala 1 a 6">
            ${[1,2,3,4,5,6].map(v => `
              <label>
                <input type="radio" name="${qId(n)}" value="${v}">
                <div class="opt" title="${v}"><div>${v}</div></div>
              </label>
            `).join('')}
          </div>`;
        frag.appendChild(q);
      });
      questionsWrap.appendChild(frag);

      // Restaura desde localStorage
      const saved = JSON.parse(localStorage.getItem('young_schema_answers') || '{}');
      for (let i=1; i<=QUESTIONS.length; i++) {
        if (saved[i]) {
          const el = document.querySelector(`input[name="${qId(i)}"][value="${saved[i]}"]`);
          if (el) el.checked = true;
        }
      }
      updateProgress();
    }

    function getFormData() {
      const get = (name) => {
        const el = document.querySelector(`[name="${name}"]`);
        return (el && typeof el.value === 'string') ? el.value.trim() : '';
      };
      return {
        nombre: get('nombre'),
        escolaridad: get('escolaridad'),
        ocupacion: get('ocupacion'),
        edad: get('edad'),
        edoCivil: get('edoCivil')
      };
    } 

    function getAnswers() {
      const ans = {};
      for (let i=1; i<=QUESTIONS.length; i++) {
        const picked = document.querySelector(`input[name="${qId(i)}"]:checked`);
        ans[i] = picked ? Number(picked.value) : 0; // 0 si no contestó
      }
      return ans;
    }

    function updateProgress() {
      const ans = getAnswers();
      let answered = 0;
      for (let i=1; i<=QUESTIONS.length; i++) if (ans[i] > 0) answered++;
      const pct = Math.round((answered / QUESTIONS.length) * 100);
      progressBar.style.width = pct + '%';
      if(progressFixed) progressFixed.style.width = pct + '%';
      answeredCountEl.textContent = answered;
      localStorage.setItem('young_schema_answers', JSON.stringify(ans));
    }

    document.addEventListener('change', (e) => {
      if (e.target && e.target.matches('input[type="radio"]')) updateProgress();
      if (e.target && e.target.matches('.input')) localStorage.setItem('young_schema_form', JSON.stringify(getFormData()));
    });

    // Restaurar datos del formulario
    (function restoreForm(){
      const f = JSON.parse(localStorage.getItem('young_schema_form') || '{}');
      for (const k of ['nombre','escolaridad','ocupacion','edad','edoCivil']) {
        const el = document.querySelector(`[name="${k}"]`);
        if (el && f[k]) el.value = f[k];
      }
    })();

    // Cálculos por grupos (equivalente a col. B, C y D)
    function calcGroupResults(ans) {
      const rows = GROUPS.map(g => {
        let sum = 0;
        for (let i=g.start; i<=g.end; i++) sum += (ans[i] || 0);
        const reactivos = g.end - g.start + 1;
        const max = reactivos * 6; // col. C
        const pct = max > 0 ? (sum / max) * 100 : 0; // col. D
        return { group: g.name, range: `${g.start}-${g.end}`, sum, max, pct };
      });
      return rows;
    }

    // Email (HTML y texto) reutilizable
    // Email (HTML y texto) reutilizable
function buildEmailContent(formData, ans, rows) {
  const answersHtml = Object.keys(ans)
    .map((i) => {
      const v = (ans[i] ?? 0);
      return `<tr><td style="padding:4px 6px;border:1px solid #ddd;text-align:right">${i}</td><td style="padding:4px 6px;border:1px solid #ddd">${v}</td></tr>`;
    })
    .join('');

  const rowsHtml = rows
    .map((r) =>
      `<tr>
        <td style="padding:6px;border:1px solid #ddd">${r.group}</td>
        <td style="padding:6px;border:1px solid #ddd">${r.range}</td>
        <td style="padding:6px;border:1px solid #ddd;text-align:right">${r.sum}</td>
        <td style="padding:6px;border:1px solid #ddd;text-align:right">${r.max}</td>
        <td style="padding:6px;border:1px solid #ddd;text-align:right">${Number(r.pct).toFixed(2)}%</td>
      </tr>`
    )
    .join('');

  const subject = 'Resultados – Cuestionario de Esquemas (Young)';

  const html = `
    <div>
      <h2>CUESTIONARIO DE ESQUEMAS DE J. YOUNG</h2>
      <p><b>Nombre:</b> ${formData.nombre || ''}<br>
         <b>Escolaridad:</b> ${formData.escolaridad || ''}<br>
         <b>Ocupación:</b> ${formData.ocupacion || ''}<br>
         <b>Edad:</b> ${formData.edad || ''}<br>
         <b>Estado civil:</b> ${formData.edoCivil || ''}</p>
      <h3>Totales por grupo</h3>
      <table style="border-collapse:collapse;border:1px solid #ddd">
        <thead><tr style="background:#f4f4f4"><th style="padding:6px;border:1px solid #ddd">Grupo</th><th style="padding:6px;border:1px solid #ddd">Rango</th><th style="padding:6px;border:1px solid #ddd">Suma</th><th style="padding:6px;border:1px solid #ddd">Máximo</th><th style="padding:6px;border:1px solid #ddd">%</th></tr></thead>
        <tbody>${rowsHtml}</tbody>
      </table>
      <h3>Respuestas</h3>
      <table style="border-collapse:collapse;border:1px solid #ddd">
        <thead><tr style="background:#f4f4f4"><th style="padding:6px;border:1px solid #ddd">#</th><th style="padding:6px;border:1px solid #ddd">Respuesta</th></tr></thead>
        <tbody>${answersHtml}</tbody>
      </table>
    </div>`.trim();

  const text = [
    'Resultados – Cuestionario de Esquemas (Young)',
    `Nombre: ${formData.nombre || ''}`,
    `Escolaridad: ${formData.escolaridad || ''}`,
    `Ocupación: ${formData.ocupacion || ''}`,
    `Edad: ${formData.edad || ''}`,
    `Estado civil: ${formData.edoCivil || ''}`,
    '',
    ...rows.map((r) => `${r.group} [${r.range}]: ${r.sum}/${r.max} = ${Number(r.pct).toFixed(2)}%`)
  ].join('\n');

  return { subject, html, text };
}

function renderResultsTable(rows) {
  if (!Array.isArray(rows) || rows.length === 0) {
    console.warn('renderResultsTable: rows vacío o inválido');
    return;
  }

  const fmt = (n) => Number(n || 0).toLocaleString('es-MX');
  const pctFmt = (n) => `${Number(n || 0).toFixed(2)}%`;

  const totalSum = rows.reduce((a, b) => a + Number(b.sum || 0), 0);
  const totalMax = rows.reduce((a, b) => a + Number(b.max || 0), 0);
  const totalPct = totalMax > 0 ? (totalSum / totalMax) * 100 : 0;

  const tableHtml = `
    <table>
      <thead>
        <tr>
          <th>Grupo</th>
          <th>Rango</th>
          <th>Suma (B)</th>
          <th>Máx (C)</th>
          <th>% (D)</th>
        </tr>
      </thead>
      <tbody>
        ${rows.map(r => `
          <tr>
            <td>${r.group}</td>
            <td>${r.range}</td>
            <td>${fmt(r.sum)}</td>
            <td>${fmt(r.max)}</td>
            <td>${pctFmt(r.pct)}</td>
          </tr>
        `).join('')}
      </tbody>
      <tfoot>
        <tr>
          <th>Total</th>
          <th>—</th>
          <th>${fmt(totalSum)}</th>
          <th>${fmt(totalMax)}</th>
          <th>${pctFmt(totalPct)}</th>
        </tr>
      </tfoot>
    </table>`.trim();

  const wrap = document.getElementById('resultsTableWrap');
  const card = document.getElementById('resultsCard');
  if (wrap) wrap.innerHTML = tableHtml;
  if (card) card.style.display = 'block';
}


    // CSV de respaldo
    function toCSV(ans, rows) {
      const header = ['Pregunta','Respuesta'];
      const lines = [header.join(',')];
      for (let i=1; i<=QUESTIONS.length; i++) lines.push(`${i},${ans[i]||0}`);
      lines.push('');
      lines.push(['Grupo','Rango','Suma','Max','Porcentaje'].join(','));
      for (const r of rows) lines.push([r.group, r.range, r.sum, r.max, r.pct.toFixed(2)+'%'].join(','));
      return lines.join('\n');
    }

    // Construye el mensaje para WhatsApp (resumen compacto)
    function buildWhatsAppMessage(formData, rows, ans) {
      const ln = '\n';

      const header = [
        'Resultados – Cuestionario de Esquemas (Young)',
        `Nombre: ${formData?.nombre || ''}`,
        `Escolaridad: ${formData?.escolaridad || ''}`,
        `Ocupación: ${formData?.ocupacion || ''}`,
        `Edad: ${formData?.edad || ''}`,
        `Estado civil: ${formData?.edoCivil || ''}`
      ].join(ln);

      const body = (Array.isArray(rows) ? rows : []).map((r, i) => {
        const pct = Number(r?.pct || 0).toFixed(1);
        const sum = Number(r?.sum || 0);
        const max = Number(r?.max || 0);
        const range = r?.range || '';
        const group = r?.group || `Grupo ${i + 1}`;
        return `${i + 1}. ${group} [${range}]: ${sum}/${max} = ${pct}%`;
      }).join(ln);

      let msg = `${header}${ln}${ln}Totales por grupo:${ln}${body}`;

      if (WHATSAPP_CONFIG?.addAnswers) {
        const a = ans || {};
        const answers = Object.keys(a).map(i => `${i}: ${a[i] || 0}`).join(', ');
        msg += `${ln}${ln}Respuestas: ${answers}`;
      }

      return msg;
    }


    function openWhatsApp(formData, rows, ans){
      if (!WHATSAPP_CONFIG.number) return;
      const msg = buildWhatsAppMessage(formData, rows, ans);
      const url = `https://wa.me/${WHATSAPP_CONFIG.number}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
    }

    // Envío por Postmark (via tu endpoint serverless)
    async function sendViaPostmark(formData, ans, rows){
      if (!POSTMARK_CONFIG.endpointUrl) throw new Error('Endpoint Postmark no configurado');
      if (!POSTMARK_CONFIG.toEmail || !POSTMARK_CONFIG.fromEmail) throw new Error('Configura toEmail y fromEmail en POSTMARK_CONFIG');
      const {subject, html, text} = buildEmailContent(formData, ans, rows);
      const res = await fetch(POSTMARK_CONFIG.endpointUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ to: POSTMARK_CONFIG.toEmail, from: POSTMARK_CONFIG.fromEmail, subject, html, text })
      });
      if (!res.ok) throw new Error('Fallo el endpoint Postmark');
      return await res.json();
    }

   // (Opcional) EmailJS como fallback si no quieres backend
    function sendViaEmailJS(formData, ans, rows) {
      if (!window.emailjs) {
        return Promise.reject(new Error('EmailJS no cargado'));
      }
      if (!EMAILJS_CONFIG.serviceId || EMAILJS_CONFIG.serviceId.startsWith('REEMPLAZA')) {
        return Promise.reject(new Error('Configura tus claves de EmailJS en EMAILJS_CONFIG.'));
      }

      const { subject, html } = buildEmailContent(formData, ans, rows);
      try { emailjs.init(EMAILJS_CONFIG.publicKey); } catch {}

      return emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.templateId, {
        to_email: EMAILJS_CONFIG.toEmail,
        subject,
        form_nombre: formData?.nombre || '',
        form_escolaridad: formData?.escolaridad || '',
        form_ocupacion: formData?.ocupacion || '',
        form_edad: formData?.edad || '',
        form_edocivil: formData?.edoCivil || '',
        html_content: html
      });
    }

    // Eventos
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const form = getFormData();
      const ans = getAnswers();
      const rows = calcGroupResults(ans);
      renderResultsTable(rows);

      // Guarda CSV localmente como respaldo
      const csv = toCSV(ans, rows);
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'resultados_cuestionario_young.csv';
      a.style.display = 'none'; document.body.appendChild(a); a.click();
      setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 100);

      // Abrir WhatsApp (si configuraste número)
      try { openWhatsApp(form, rows, ans); } catch {}

      // Intentar Postmark primero
      try {
        await sendViaPostmark(form, ans, rows);
        alert('¡Resultados enviados por correo (Postmark)! y CSV descargado');
      } catch (e1) {
        console.warn('Postmark falló o no está configurado:', e1);
        // Fallback EmailJS si lo configuraste
        try {
          await sendViaEmailJS(form, ans, rows);
          alert('¡Resultados enviados por correo (EmailJS)! y CSV descargado');
        } catch (e2) {
          console.warn('EmailJS también falló:', e2);
          alert('No se pudo enviar por correo. Se descargó un CSV con respaldo. También se abrió WhatsApp si configuraste un número.');
        }
      }

      window.scrollTo({ top: document.getElementById('resultsCard').offsetTop - 16, behavior: 'smooth' });
    });

    document.getElementById('exportCsvBtn').addEventListener('click', () => {
      const ans = getAnswers();
      const rows = calcGroupResults(ans);
      const csv = toCSV(ans, rows);
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'resultados_cuestionario_young.csv';
      a.style.display = 'none'; document.body.appendChild(a); a.click();
      setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 100);
    });



    function safeInit(){
      try {
        if (!Array.isArray(QUESTIONS) || QUESTIONS.length === 0) {
          console.warn('QUESTIONS vacío; creando placeholders');
          window.QUESTIONS = Array.from({length:205}, (_,i)=>`Pregunta ${i+1}`);
        }
        renderQuestions();
      } catch (e) {
        console.error('Error inicializando preguntas', e);
        alert('Hubo un error mostrando las preguntas. Revisa la consola del navegador.');
      }
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', safeInit);
    } else { safeInit(); }
  </script>
</body>
</html>
